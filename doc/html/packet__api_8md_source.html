<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>MoonGen: /home/dominik/MoonGen/doc/packet_api.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MoonGen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="download.html"><span>Download</span></a></li>
      <li><a href="documentation.html"><span>Documentation</span></a></li>
      <li class="current"><a href="files.html"><span>Filebrowser</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('packet__api_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/home/dominik/MoonGen/doc/packet_api.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;\page packet_api Packet API</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;\tableofcontents</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;The DPDK provides one main data <span class="keyword">struct </span>to work with packets: rte_mbuf. MoonGen provides further wrappers, offering enhanced and easy-to-use functions while maintaining critical performance.</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;\section rte_mbuf rte_mbuf</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;TBD: Mainly internal struct. Provides some fields to store meta data. Otherwise the actual packet is only bytes.</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;\section packet_wrappers Dynamic creation of wrappers for c-structs of different packet types</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;Lua wrapper for the actual packet data. The data can be casted to different kinds of packets that get created dynamically.</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;\subsection pw_overview Overview</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;As working with raw bytes isn&#39;t productive, MoonGen provides the ability to cast a &#39;struct rte_mbuf&#39; to different kinds of packets. </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;The hereby used c struct is dynamically created, depending on the used cast function. </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;The members of the struct are the different headers of the used packet type (for instance an ethernet header, followed by an IPv4 header, ..., followed by payload). </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;The headers themselves are implemented in \ref headers.lua .</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;The respective lua wrapper module of each header can be found in the proto/ folder. </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;These provide the functions on the header and its members. </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;The functions on packets are dynamically created so they don&#39;t have to be reimplemented for each, only minorly differing packettype. </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;They are explained in section \ref pw_packets .</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;\subsection pw_members Functions on Members</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;The functions for each member of a protocols header are defined in the respective file in the proto/ subfolder. For each member the following functions are implemented:</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;- <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a>(value) <a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">\n</a></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  Set the member (the bytes of that member) to &#39;value&#39;. Takes care of correct byte order. If no value is provided a reasonable default value is used instead.</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;- get() <a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">\n</a></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  Returns the value of the member. Refer to the documentation to find out the actual data type of the value (number, cdata, ...).</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;- <a class="code" href="arp_8lua.html#a0c54aeefe661a546eb4adc30d8b311ef">getString</a>() <a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">\n</a></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  Returns a string representation of that value.</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;Refer to the filebrowser for a complete list of available functions and their documentation.</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;\subsection pw_headers Functions on Headers</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;In addition to the above, the following functions are implemented for the header itself:</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;- <a class="code" href="arp_8lua.html#aa4fec404844cc2c6cb2c0b83ad3040f4">fill</a>(namedArgs, prefix) <a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">\n</a></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  Invokes the <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a> function of each member of this header. namedArgs is a table containing the values that should be passed to each separate <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a>() function, identified via the respective named argument prepended with the prefix.</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  For instance if the header of a packet (so this packets member) is called &#39;ip4&#39; and one wants to <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a> the protocol field and version.</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;\code{.lua}</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;:<a class="code" href="arp_8lua.html#aa4fec404844cc2c6cb2c0b83ad3040f4">fill</a>({ <span class="stringliteral">&#39;ip4Protocol&#39;</span>=13, <span class="stringliteral">&#39;ip4Version&#39;</span>=1 }, <span class="stringliteral">&#39;ip4&#39;</span>)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;\endcode</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  All arguments starting with the prefix <span class="stringliteral">&#39;ip4&#39;</span> will be passed to the respective <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a>() function, all other <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a>() functions are called without parameter, hence the default value is <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a>.</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  For the list of available arguments see the respective <a class="code" href="arp_8lua.html#aa4fec404844cc2c6cb2c0b83ad3040f4">fill</a>() method.</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;- get(prefix) \<a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  Invokes the get function of each member of this header and returns all of their value as table, using the a table of the same named arguments as above, prepended with the specified prefix.</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;- <a class="code" href="arp_8lua.html#a0c54aeefe661a546eb4adc30d8b311ef">getString</a>() \<a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  Returns a <span class="keywordtype">string</span> that is <a class="code" href="filter_8lua.html#a561c0a4046cbb613a25d32b303cad427">build</a> by invoking the <a class="code" href="arp_8lua.html#a0c54aeefe661a546eb4adc30d8b311ef">getString</a> function of each member and concatinating the results. This is mainly used to <a class="code" href="packet_8lua.html#a2635156d751e509e4b4f607a2b045c5a">dump</a> the header. </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;Note that the <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a> and get function are slow as they use lua tables. Do not use them in time critical parts of your code. Normally you would only use them to prefill a mempool.</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;Furthermore, there are two functions for each header that are only used internally.</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;\subsection pw_packets Functions on Packets</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;- <a class="code" href="arp_8lua.html#aa4fec404844cc2c6cb2c0b83ad3040f4">fill</a>(namedArgs) \<a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  Invokes <a class="code" href="arp_8lua.html#aa4fec404844cc2c6cb2c0b83ad3040f4">fill</a>() for each header (using the correct prefix) and passes the specified table of named arguments. This function always provides &quot;intelligent&quot; default values for named arguments that are not specified. </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  For instance the etherType of an IP4 packet will always be <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a> to the value of IP4, while for an IP6 packet it will be <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a> to the etherType of IP6 (unless the table contains an entry &#39;&amp;lt;prefix&amp;gt;Type&#39;, then this will always be used instead). </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;- get() \<a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  Invokes get() on each header and returns one resulting table.</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;- <a class="code" href="packet_8lua.html#a2635156d751e509e4b4f607a2b045c5a">dump</a>(bytes) \<a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  Prints a tcpdump-like <a class="code" href="packet_8lua.html#a2635156d751e509e4b4f607a2b045c5a">dump</a> of the packet including full cleartext of the headers. Either dumps the specified number of bytes or estimated from the length of the packet struct.</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;- <a class="code" href="ip4_8lua.html#aad67eee9c45fb930f74be8ba6d7114d8">setLength</a>(len) \<a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  Set the length value of each header (it it has one) depending on the packet length and the position of the header in the packet (basically by accumulating the length of headers before this header).</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;- calculateChecksums() \<a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  Calculate all checksums of all headers (that have a <a class="code" href="utils_8lua.html#ab50a328c48b6841b1c0c78c6fd811dd8">checksum</a> field) in software. Has significant impact on the performance. If possible, use <a class="code" href="utils_8lua.html#ab50a328c48b6841b1c0c78c6fd811dd8">checksum</a>-offloading. &lt;!-- TODO link it--&gt;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;- calculateChecksumXYZ() \<a class="code" href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  For each header XYZ of the packet that has a <a class="code" href="utils_8lua.html#ab50a328c48b6841b1c0c78c6fd811dd8">checksum</a> member a function to calculate it in software is provided (e.g. calculateChecksumIcmp). Has significant impact on the performance. If possible, use <a class="code" href="utils_8lua.html#ab50a328c48b6841b1c0c78c6fd811dd8">checksum</a>-offloading.</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;\section create_packet_wrappers Create <a class="code" href="barrier_8lua.html#a24e198c210d92b2489e731362d31ba17">new</a> packet types</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;The function <a class="code" href="packet_8lua.html#a9ec741ec046b38ff23624e841a2ec3da">packetCreate</a>() of the packet.lua module can be used to create a <a class="code" href="barrier_8lua.html#a24e198c210d92b2489e731362d31ba17">new</a> user-defined packet type. The user only has to provide the protocols in the order they should appear in the packet. It then automatically creates the respective c struct, consisting of the names headers. The last member is always payload. Furthermore, it automatcally creates the functions mentioned in \ref pw_packets for this kind of packet. <a class="code" href="packet_8lua.html#a9ec741ec046b38ff23624e841a2ec3da">packetCreate</a>() returns the cast function for the created packet type.</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;Per default, the member of the packet for each protocol will be named after the protocol (protocol: ip4, member: ip4). The member can manually be renamed by specifying the name of the protocol, followed by the name of the member in a list, e.g. { <span class="stringliteral">&#39;ip4&#39;</span>, <span class="stringliteral">&#39;innerIP&#39;</span>}.</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;Available protocols: <a class="code" href="ethernet_8lua.html#abd4d16011dee203ba12fc0b0cb1df914">eth</a> (ethernet), ip4, <a class="code" href="ip6_8lua.html#a48f8232a17cb626a8ad3e95972a69e52">ip6</a>, <a class="code" href="udp_8lua.html#a605be069667aac4e9674572dee46d278">udp</a>, tcp, <a class="code" href="arp_8lua.html#a02203ea250dfb1428f95db578e7ce4f3">arp</a>, <a class="code" href="icmp_8lua.html#a57104013bdcc76206b6408e63148131a">icmp</a>, <a class="code" href="ptp_8lua.html#add61ce13e4ff069b3c009f428ce6260c">ptp</a>.</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;Example:</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;\code{.lua}</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;local myPacketType = <a class="code" href="packet_8lua.html#a9ec741ec046b38ff23624e841a2ec3da">packetCreate</a>(<span class="stringliteral">&#39;eth&#39;</span>, <span class="stringliteral">&#39;ip4&#39;</span>, { <span class="stringliteral">&#39;eth&#39;</span>, <span class="stringliteral">&#39;secondEth&#39;</span> })</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;\endcode</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;The created c <span class="keyword">struct</span> will look as follows:</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;\code{.c}</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keyword">struct </span>ethernet_header <a class="code" href="ethernet_8lua.html#abd4d16011dee203ba12fc0b0cb1df914">eth</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">struct </span>ip4_header ip4;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keyword">struct </span>ethernet_header secondEth;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keyword">union </span>payload_t payload;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;\endcode</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;\subsection pw_summary Summary</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;Aside from the existing types of packets (listed in the <span class="stringliteral">&#39;Packets&#39;</span> section of each respective protocol module) a user can at any time define further, custom packets. MoonGen then automatically provides functions to work on the packet, on each header of that packet and on each member of such a header. </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;\code{.lua}</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;buf = buf:<a class="code" href="udp_8lua.html#adaa53b02964eaa0ac8d46b96eceeabbe">getUdpPacket</a>()</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;buf.udp.src = hton(1234)     -- case 1</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;buf.udp:<a class="code" href="tcp_8lua.html#a15b5825ba42f81e0560ffe1bfeab7627">setSrcPort</a>(1234)     -- case 2</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;buf.udp:<a class="code" href="arp_8lua.html#aa4fec404844cc2c6cb2c0b83ad3040f4">fill</a>{ udpSrc=1234 }  -- <span class="keywordflow">case</span> 3</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;buf:<a class="code" href="arp_8lua.html#aa4fec404844cc2c6cb2c0b83ad3040f4">fill</a>{ udpSrc=1234 }      -- <span class="keywordflow">case</span> 4</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;\endcode</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;All of the four cases result in the same 16 bits of the data <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a> accordingly. However, there are slight differences:</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;- <span class="keywordflow">case</span> 1: Directly works on the c <span class="keyword">struct</span>. You have to take care of <span class="keywordflow">for</span> instance correct byte order yourself.</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;- <span class="keywordflow">case</span> 2: Using the utility functions <span class="keywordflow">for</span> members. This method is the recommended one when setting members during the actual <span class="stringliteral">&#39;runtime&#39;</span> of MoonGen. It takes care of correct types and byte order <span class="keywordflow">while</span> providing the same speed.</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;- <span class="keywordflow">case</span> 3 and 4: Using a table of named arguments to <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a> multiple/all members of a/all header(s). This method is considerably slower than <span class="keywordflow">case</span> 2. The advantage is you can <a class="code" href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a> members to the values you specify and all other members to <span class="keywordflow">default</span> values, fitting <span class="keywordflow">for</span> the current packet type. This method is therefore recommended when prefilling mempools.</div>
<div class="ttc" id="udp_8lua_html_adaa53b02964eaa0ac8d46b96eceeabbe"><div class="ttname"><a href="udp_8lua.html#adaa53b02964eaa0ac8d46b96eceeabbe">getUdpPacket</a></div><div class="ttdeci">pkt getUdpPacket</div><div class="ttdoc">Cast the packet to an Udp packet, either using IP4 (nil/true) or IP6 (false), depending on the passed...</div><div class="ttdef"><b>Definition:</b> <a href="udp_8lua_source.html#l00142">udp.lua:142</a></div></div>
<div class="ttc" id="arp_8lua_html_a0c54aeefe661a546eb4adc30d8b311ef"><div class="ttname"><a href="arp_8lua.html#a0c54aeefe661a546eb4adc30d8b311ef">getString</a></div><div class="ttdeci">function arpHeader getString()</div><div class="ttdoc">Retrieve the values of all members. </div></div>
<div class="ttc" id="utils_8lua_html_ab50a328c48b6841b1c0c78c6fd811dd8"><div class="ttname"><a href="utils_8lua.html#ab50a328c48b6841b1c0c78c6fd811dd8">checksum</a></div><div class="ttdeci">function checksum(data, len)</div><div class="ttdoc">Calculate a 16 bit checksum. </div></div>
<div class="ttc" id="filter_8lua_html_a561c0a4046cbb613a25d32b303cad427"><div class="ttname"><a href="filter_8lua.html#a561c0a4046cbb613a25d32b303cad427">build</a></div><div class="ttdeci">function mg_filter_5tuple build(numCategories)</div><div class="ttdoc">Builds the filter with the currently added rules. </div></div>
<div class="ttc" id="packet_8lua_html_a9ec741ec046b38ff23624e841a2ec3da"><div class="ttname"><a href="packet_8lua.html#a9ec741ec046b38ff23624e841a2ec3da">packetCreate</a></div><div class="ttdeci">function packetCreate(...)</div><div class="ttdoc">Create struct and functions for a new packet. </div></div>
<div class="ttc" id="packet_8lua_html_a2635156d751e509e4b4f607a2b045c5a"><div class="ttname"><a href="packet_8lua.html#a2635156d751e509e4b4f607a2b045c5a">dump</a></div><div class="ttdeci">function pkt dump(bytes)</div><div class="ttdoc">Dumps the packet data cast to the best fitting packet struct. </div></div>
<div class="ttc" id="barrier_8lua_html_a24e198c210d92b2489e731362d31ba17"><div class="ttname"><a href="barrier_8lua.html#a24e198c210d92b2489e731362d31ba17">new</a></div><div class="ttdeci">function mod new(n)</div></div>
<div class="ttc" id="udp_8lua_html_a605be069667aac4e9674572dee46d278"><div class="ttname"><a href="udp_8lua.html#a605be069667aac4e9674572dee46d278">udp</a></div><div class="ttdeci">local udp</div><div class="ttdoc">Udp protocol constants. </div><div class="ttdef"><b>Definition:</b> <a href="udp_8lua_source.html#l00023">udp.lua:23</a></div></div>
<div class="ttc" id="ip4_8lua_html_aad67eee9c45fb930f74be8ba6d7114d8"><div class="ttname"><a href="ip4_8lua.html#aad67eee9c45fb930f74be8ba6d7114d8">setLength</a></div><div class="ttdeci">function ip4Header setLength(int)</div><div class="ttdoc">Set the total length. </div></div>
<div class="ttc" id="arp_8lua_html_a02203ea250dfb1428f95db578e7ce4f3"><div class="ttname"><a href="arp_8lua.html#a02203ea250dfb1428f95db578e7ce4f3">arp</a></div><div class="ttdeci">local arp</div><div class="ttdoc">Arp protocol constants. </div><div class="ttdef"><b>Definition:</b> <a href="arp_8lua_source.html#l00032">arp.lua:32</a></div></div>
<div class="ttc" id="tcp_8lua_html_a15b5825ba42f81e0560ffe1bfeab7627"><div class="ttname"><a href="tcp_8lua.html#a15b5825ba42f81e0560ffe1bfeab7627">setSrcPort</a></div><div class="ttdeci">function tcpHeader setSrcPort(int)</div><div class="ttdoc">Set the source port. </div></div>
<div class="ttc" id="ptp_8lua_html_add61ce13e4ff069b3c009f428ce6260c"><div class="ttname"><a href="ptp_8lua.html#add61ce13e4ff069b3c009f428ce6260c">ptp</a></div><div class="ttdeci">local ptp</div><div class="ttdoc">Ptp protocol constants. </div><div class="ttdef"><b>Definition:</b> <a href="ptp_8lua_source.html#l00023">ptp.lua:23</a></div></div>
<div class="ttc" id="ethernet_8lua_html_abd4d16011dee203ba12fc0b0cb1df914"><div class="ttname"><a href="ethernet_8lua.html#abd4d16011dee203ba12fc0b0cb1df914">eth</a></div><div class="ttdeci">local eth</div><div class="ttdoc">Ethernet protocol constants. </div><div class="ttdef"><b>Definition:</b> <a href="ethernet_8lua_source.html#l00024">ethernet.lua:24</a></div></div>
<div class="ttc" id="ip6_8lua_html_a48f8232a17cb626a8ad3e95972a69e52"><div class="ttname"><a href="ip6_8lua.html#a48f8232a17cb626a8ad3e95972a69e52">ip6</a></div><div class="ttdeci">local ip6</div><div class="ttdoc">IP6 protocol constants. </div><div class="ttdef"><b>Definition:</b> <a href="ip6_8lua_source.html#l00025">ip6.lua:25</a></div></div>
<div class="ttc" id="arp_8lua_html_aa4fec404844cc2c6cb2c0b83ad3040f4"><div class="ttname"><a href="arp_8lua.html#aa4fec404844cc2c6cb2c0b83ad3040f4">fill</a></div><div class="ttdeci">function arpHeader fill(args, pre)</div><div class="ttdoc">Set all members of the ip header. </div></div>
<div class="ttc" id="memory_8lua_html_aeab71244afb687f16d8c4f5ee9d6ef0e"><div class="ttname"><a href="memory_8lua.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div><div class="ttdeci">n</div><div class="ttdoc">Create a new array of memory buffers (initialized to nil). </div><div class="ttdef"><b>Definition:</b> <a href="memory_8lua_source.html#l00076">memory.lua:76</a></div></div>
<div class="ttc" id="ethernet_8lua_html_a77e75ae36313b17315d8ced823089f9e"><div class="ttname"><a href="ethernet_8lua.html#a77e75ae36313b17315d8ced823089f9e">set</a></div><div class="ttdeci">function macAddr set(addr)</div><div class="ttdoc">Set the MAC address. </div></div>
<div class="ttc" id="icmp_8lua_html_a57104013bdcc76206b6408e63148131a"><div class="ttname"><a href="icmp_8lua.html#a57104013bdcc76206b6408e63148131a">icmp</a></div><div class="ttdeci">local icmp</div><div class="ttdoc">Icmp4 protocol constants. </div><div class="ttdef"><b>Definition:</b> <a href="icmp_8lua_source.html#l00025">icmp.lua:25</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>packet_api.md</b></li>
    <li class="footer">Generated on Mon Aug 24 2015 22:09:13 for MoonGen by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
